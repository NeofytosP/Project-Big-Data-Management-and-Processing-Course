### 2.7 Aggregations

**Artists with most popular track ordered by track popularity**


```python
# MySQL
total_time = 0
for i in range(20):
    start = time.perf_counter()
    MyCursor.execute('SELECT artist_name FROM artists a JOIN tracks t ON a.artist_id=t.artist_id GROUP BY a.artist_name ORDER BY MAX(t.popularity) DESC LIMIT 20')
    myresult = MyCursor.fetchall()
    for x in myresult:
        pass
    end = time.perf_counter()
    total_time += end - start
average_time = total_time / 20
print(f"Average response time {average_time:.3f} seconds")
MySQL_Q41 = average_time
```

    Average response time 17.642 seconds
    


```python
# MongoDB
total_time = 0
for i in range(20):
    start = time.perf_counter()
    MongoDB_songs = list(songs_collection.aggregate([{'$group': {'_id':'$artist_name','max_popularity': {'$max':'$popularity'}}},{'$sort':{'max_popularity':-1}},{'$limit':20}]))
    for x in MongoDB_songs:
        pass
    end = time.perf_counter()
    total_time += end - start
average_time = total_time / 20
print(f"Average response time {average_time:.3f} seconds")
LocalMongoDB_Q41 = average_time
```

    Average response time 0.395 seconds
    


```python
# MongoDB Cloud
total_time = 0
for i in range(20):
    start = time.perf_counter()
    MongoDB_Songs_Cloud = list(cloud_songs_collection.aggregate([{'$group': {'_id':'$artist_name','max_popularity': {'$max':'$popularity'}}},{'$sort':{'max_popularity':-1}},{'$limit':20}]))
    for x in MongoDB_Songs_Cloud:
        pass
    end = time.perf_counter()
    total_time += end - start

average_time = total_time / 20
print(f"Average response time {average_time:.3f} seconds")
Cloud_MongoDB_Q41 = average_time
```

    Average response time 1.032 seconds
    



**Number of tracks per year**


```python
# MySQL
total_time = 0
for i in range(20):
    start = time.perf_counter()
    MyCursor.execute('SELECT release_year,COUNT(track_name) FROM tracks GROUP BY release_year')
    myresult = MyCursor.fetchall()
    for x in myresult:
        pass
    end = time.perf_counter()
    total_time += end - start
average_time = total_time / 20
print(f"Average response time {average_time:.3f} seconds")
MySQL_Q42 = average_time
```

    Average response time 11.924 seconds
    


```python
# MongoDB
total_time = 0
for i in range(20):
    start = time.perf_counter()
    MongoDB_songs = list(songs_collection.aggregate([{'$group':{'_id':'$release_year','tracks':{'$sum':1}}},{'$sort':{'_id':1}}]))
    for x in MongoDB_songs:
        pass
    end = time.perf_counter()
    total_time += end - start
average_time = total_time / 20
print(f"Average response time {average_time:.3f} seconds")
LocalMongoDB_Q42 = average_time
```

    Average response time 0.228 seconds
    


```python
# MongoDB Cloud
total_time = 0
for i in range(20):
    start = time.perf_counter()
    MongoDB_Songs_Cloud = list(cloud_songs_collection.aggregate([{'$group':{'_id':'$release_year','tracks':{'$sum':1}}},{'$sort':{'_id':1}}]))
    for x in MongoDB_Songs_Cloud:
        pass
    end = time.perf_counter()
    total_time += end - start

average_time = total_time / 20
print(f"Average response time {average_time:.3f} seconds")
Cloud_MongoDB_Q42 = average_time
```

    Average response time 0.462 seconds
    




**Most Famous Artists**


```python
# MySQL
total_time = 0
for i in range(20):
    start = time.perf_counter()
    MyCursor.execute('SELECT a.artist_name,AVG(t.popularity) AS average_popularity FROM artists a JOIN tracks t ON a.artist_id=t.artist_id GROUP BY artist_name ORDER BY average_popularity DESC LIMIT 20')
    myresult = MyCursor.fetchall()
    for x in myresult:
        pass
    end = time.perf_counter()
    total_time += end - start
average_time = total_time / 20
print(f"Average response time {average_time:.3f} seconds")
MySQL_Q43 = average_time
```

    Average response time 17.200 seconds
    


```python
# MongoDB
total_time = 0
for i in range(20):
    start = time.perf_counter()
    MongoDB_songs = list(songs_collection.aggregate([{'$group':{'_id':'$artist_name','avg_popularity':{'$avg':'$popularity'}}},{'$sort':{'avg_popularity':-1}},{'$limit':20}]))
    for x in MongoDB_songs:
        pass
    end = time.perf_counter()
    total_time += end - start
average_time = total_time / 20
print(f"Average response time {average_time:.3f} seconds")
LocalMongoDB_Q43 = average_time
```

    Average response time 0.497 seconds
    


```python
# MongoDB Cloud
total_time = 0
for i in range(20):
    start = time.perf_counter()
    MongoDB_Songs_Cloud = list(cloud_songs_collection.aggregate([{'$group':{'_id':'$artist_name','avg_popularity':{'$avg':'$popularity'}}},{'$sort':{'avg_popularity':-1}},{'$limit':20}]))
    for x in MongoDB_Songs_Cloud:
        pass
    end = time.perf_counter()
    total_time += end - start

average_time = total_time / 20
print(f"Average response time {average_time:.3f} seconds")
Cloud_MongoDB_Q43 = average_time
```

    Average response time 1.365 seconds
    



**Most Famous Genres**


```python
# MySQL
total_time = 0
for i in range(20):
    start = time.perf_counter()
    MyCursor.execute('SELECT genre,AVG(popularity) AS average_popularity FROM tracks GROUP BY genre ORDER BY average_popularity DESC')
    myresult = MyCursor.fetchall()
    for x in myresult:
        pass
    end = time.perf_counter()
    total_time += end - start
average_time = total_time / 20
print(f"Average response time {average_time:.3f} seconds")
MySQL_Q44 = average_time
```

    Average response time 14.294 seconds
    


```python
# MongoDB
total_time = 0
for i in range(20):
    start = time.perf_counter()
    MongoDB_songs = list(songs_collection.aggregate([{'$group':{'_id':'$genre','avg_popularity':{'$avg':'$popularity'}}},{'$sort':{'avg_popularity':-1}},{'$limit':20}]))
    for x in MongoDB_songs:
        pass
    end = time.perf_counter()
    total_time += end - start
average_time = total_time / 20
print(f"Average response time {average_time:.3f} seconds")
LocalMongoDB_Q44 = average_time
```

    Average response time 0.349 seconds
    


```python
# MongoDB Cloud
total_time = 0
for i in range(20):
    start = time.perf_counter()
    MongoDB_Songs_Cloud = list(cloud_songs_collection.aggregate([{'$group':{'_id':'$genre','avg_popularity':{'$avg':'$popularity'}}},{'$sort':{'avg_popularity':-1}},{'$limit':20}]))
    for x in MongoDB_Songs_Cloud:
        pass
    end = time.perf_counter()
    total_time += end - start

average_time = total_time / 20
print(f"Average response time {average_time:.3f} seconds")
Cloud_MongoDB_Q44 = average_time
```

    Average response time 0.685 seconds
    




**Top tracks per year**


```python
# MySQL
total_time = 0
for i in range(20):
    start = time.perf_counter()
    MyCursor.execute('SELECT t.release_year,t.track_name,t.popularity FROM tracks t JOIN (SELECT release_year,MAX(popularity) AS max_popularity FROM tracks GROUP BY release_year) m ON t.release_year=m.release_year AND t.popularity=m.max_popularity ORDER BY t.release_year DESC')
    myresult = MyCursor.fetchall()
    for x in myresult:
        pass
    end = time.perf_counter()
    total_time += end - start
average_time = total_time / 20
print(f"Average response time {average_time:.3f} seconds")
MySQL_Q45 = average_time
```

    Average response time 13.150 seconds
    


```python
# MongoDB
total_time = 0
for i in range(20):
    start = time.perf_counter()
    MongoDB_songs = list(songs_collection.aggregate([{'$sort':{'release_year':-1,'popularity':-1}},{'$group':{'_id':'$release_year','track_name':{'$first':'$track_name'},'popularity':{'$max':'$popularity'}}},{'$project':{'release_year':'$_id','track_name':1,'popularity':1}},{'$sort':{'release_year':-1}}]))
    for x in MongoDB_songs:
        pass
    end = time.perf_counter()
    total_time += end - start
average_time = total_time / 20
print(f"Average response time {average_time:.3f} seconds")
LocalMongoDB_Q45 = average_time
```

    Average response time 1.171 seconds
    




**Top artists per year**


```python
# MySQL
total_time = 0
for i in range(20):
    start = time.perf_counter()
    MyCursor.execute('SELECT y.release_year,a.artist_name,y.total_popularity FROM (SELECT t.release_year,t.artist_id,SUM(t.popularity) AS total_popularity FROM tracks t GROUP BY t.release_year,t.artist_id) y JOIN (SELECT release_year,MAX(total_popularity) AS max_popularity FROM (SELECT release_year,artist_id,SUM(popularity) AS total_popularity FROM tracks GROUP BY release_year,artist_id) z GROUP BY release_year) m ON y.release_year=m.release_year AND y.total_popularity=m.max_popularity JOIN artists a ON y.artist_id=a.artist_id ORDER BY y.release_year DESC')
    myresult = MyCursor.fetchall()
    for x in myresult:
        pass
    end = time.perf_counter()
    total_time += end - start
average_time = total_time / 20
print(f"Average response time {average_time:.3f} seconds")
MySQL_Q46 = average_time
```

    Average response time 2.917 seconds
    


```python
# MongoDB
total_time = 0
for i in range(20):
    start = time.perf_counter()
    MongoDB_songs = list(songs_collection.aggregate([{'$group':{'_id':{'release_year':'$release_year','artist_name':'$artist_name'},'total_popularity':{'$sum':'$popularity'}}},{'$sort': {'_id,release_year':-1,"total_popularity": -1}},{'$group':{'_id': '$_id.release_year','artist_name': { '$first': '$_id.artist_name' },'popularity': { '$first': '$total_popularity' }}},{'$project':{'release_year':'$_id','artist_name':1,'popularity':1}},{'$sort': { 'release_year': -1 }}]))
    for x in MongoDB_songs:
        pass
    end = time.perf_counter()
    total_time += end - start
average_time = total_time / 20
print(f"Average response time {average_time:.3f} seconds")
LocalMongoDB_Q46 = average_time
```

    Average response time 1.265 seconds
    




**Top genres per year**


```python
# MySQL
total_time = 0
for i in range(20):
    start = time.perf_counter()
    MyCursor.execute('SELECT y.release_year,y.genre,y.total_popularity FROM (SELECT t.release_year,t.genre,SUM(t.popularity) AS total_popularity FROM tracks t GROUP BY t.release_year,t.genre) y JOIN (SELECT release_year,MAX(total_popularity) AS max_popularity FROM (SELECT release_year,genre,SUM(popularity) AS total_popularity FROM tracks GROUP BY release_year,genre) z GROUP BY release_year) m ON y.release_year=m.release_year AND y.total_popularity=m.max_popularity ORDER BY y.release_year DESC')
    myresult = MyCursor.fetchall()
    for x in myresult:
        pass
    end = time.perf_counter()
    total_time += end - start
average_time = total_time / 20
print(f"Average response time {average_time:.3f} seconds")
MySQL_Q47 = average_time
```

    Average response time 1.885 seconds
    


```python
# MongoDB
total_time = 0
for i in range(20):
    start = time.perf_counter()
    MongoDB_songs = list(songs_collection.aggregate([{'$group':{'_id':{'release_year':'$release_year','genre':'$genre'},'total_popularity':{'$sum':'$popularity'}}},{'$sort': {'_id,release_year':-1,"total_popularity": -1}},{'$group':{'_id': '$_id.release_year','genre': { '$first': '$_id.genre' },'popularity': { '$first': '$total_popularity' }}},{'$project':{'release_year':'$_id','_id':0,'genre':1,'popularity':1}},{'$sort': { 'release_year': -1 }}]))
    for x in MongoDB_songs:
        pass
    end = time.perf_counter()
    total_time += end - start
average_time = total_time / 20
print(f"Average response time {average_time:.3f} seconds")
LocalMongoDB_Q47 = average_time
```

    Average response time 0.303 seconds
    


```python
# MongoDB Cloud
total_time = 0
for i in range(20):
    start = time.perf_counter()
    MongoDB_Songs_Cloud = list(cloud_songs_collection.aggregate([{'$group':{'_id':{'release_year':'$release_year','genre':'$genre'},'total_popularity':{'$sum':'$popularity'}}},{'$sort': {'_id,release_year':-1,"total_popularity": -1}},{'$group':{'_id': '$_id.release_year','genre': { '$first': '$_id.genre' },'popularity': { '$first': '$total_popularity' }}},{'$project':{'release_year':'$_id','_id':0,'genre':1,'popularity':1}},{'$sort': { 'release_year': -1 }}]))
    for x in MongoDB_Songs_Cloud:
        pass
    end = time.perf_counter()
    total_time += end - start

average_time = total_time / 20
print(f"Average response time {average_time:.3f} seconds")
Cloud_MongoDB_Q47 = average_time
```

    Average response time 0.899 seconds
